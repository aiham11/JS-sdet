private String cleanText(String text, boolean removeAllImages) {
    if (text == null || text.isEmpty()) {
        return text;
    }

    // Option to remove all <img> tags
    if (removeAllImages) {
        text = text.replaceAll("<img[^>]*>", "");
    } else {
        // Remove duplicate image tags (assuming exact same image tags are considered duplicates)
        text = text.replaceAll("(<img[^>]+>)(\\s*\\1)+", "$1");
    }

    // Remove duplicate lines of text or patterns (if applicable)
    String[] lines = text.split("\n");
    StringBuilder cleanedText = new StringBuilder();
    Set<String> seenLines = new HashSet<>();

    for (String line : lines) {
        String trimmedLine = line.trim();
        if (!seenLines.contains(trimmedLine)) {
            cleanedText.append(trimmedLine).append("\n");
            seenLines.add(trimmedLine);
        }
    }

    // Remove any potential trailing whitespace or extra newlines
    return cleanedText.toString().trim();
}
