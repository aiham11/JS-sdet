// Inside the main migration method

// Retrieve the test steps array from Jira
JsonArray jiraTestSteps = jiraJson.getAsJsonObject("testScript").getAsJsonArray("steps");

if (jiraTestSteps != null && jiraTestSteps.size() > 0) {
    // Sort test steps by the 'index' property to maintain order
    List<JsonObject> sortedTestSteps = new ArrayList<>();
    for (JsonElement stepElement : jiraTestSteps) {
        sortedTestSteps.add(stepElement.getAsJsonObject());
    }
    sortedTestSteps.sort(Comparator.comparingInt(step -> step.get("index").getAsInt()));

    for (JsonObject step : sortedTestSteps) {
        JsonObject newTestStep = new JsonObject();

        // Add description
        String description = step.get("description").getAsString().replaceAll("<img[^>]*>", ""); // Remove <img> tags
        newTestStep.addProperty("Input", description);

        // Add test data
        String testData = step.get("testData").getAsString().replaceAll("<img[^>]*>", ""); // Remove <img> tags
        newTestStep.addProperty("ExpectedResult", testData);

        // Add expected result
        String expectedResult = step.get("expectedResult").getAsString().replaceAll("<img[^>]*>", ""); // Remove <img> tags
        newTestStep.addProperty("ExpectedResult", expectedResult);

        // Add index
        newTestStep.addProperty("StepIndex", step.get("index").getAsInt());

        // Add Test Case reference
        newTestStep.addProperty("TestCase", testCaseRef);

        // Create test step in Rally
        CreateRequest stepCreateRequest = new CreateRequest("teststep", newTestStep);
        CreateResponse stepCreateResponse = restApi.create(stepCreateRequest);

        if (stepCreateResponse.wasSuccessful()) {
            System.out.println("Successfully created test step: " + stepCreateResponse.getObject().get("_ref").getAsString());
        } else {
            System.out.println("Error occurred creating test step:");
            for (String error : stepCreateResponse.getErrors()) {
                System.out.println(error);
            }
        }
    }
} else {
    System.out.println("No test steps found in Jira response.");
}
