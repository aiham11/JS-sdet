Cannot parse object reference from "iVBORw0KGgoAAAANSUhEUgAAAok
Attachment JSON: {"Artifact":"https://rally1.rallydev.com/slm/webservice/v2.0/testcase/799053222805","Content":"iVBORw0KGgoA",Name":"500134","ContentType":"application/octet-stream","Size":26714}
Error occurred creating attachment:
Cannot parse object reference from "iVBORw0KGgoAAAANSUhEUgAAAwgAAAE7CAIAAAD2FjFqAA"


private static String uploadAttachmentToRally(File file, RallyRestApi restApi, String testCaseRef) throws IOException {
    if (file == null || !file.exists() || testCaseRef == null || testCaseRef.isEmpty()) {
        System.out.println("Invalid file or test case reference provided for attachment upload.");
        return null;
    }

    // Convert file to Base64-encoded content
    byte[] fileContent = java.nio.file.Files.readAllBytes(file.toPath());
    String base64Content = Base64.getEncoder().encodeToString(fileContent);

    // Ensure the Base64 content is not truncated and is complete
    if (base64Content == null || base64Content.isEmpty()) {
        System.out.println("Failed to encode the file to Base64.");
        return null;
    }

    JsonObject attachment = new JsonObject();
    attachment.addProperty("Artifact", testCaseRef);
    attachment.addProperty("Content", base64Content);  // Full Base64 string
    attachment.addProperty("Name", file.getName());
    attachment.addProperty("ContentType", "application/octet-stream");
    attachment.addProperty("Size", fileContent.length);

    // Debug: Print out the attachment JSON object to verify the content
    System.out.println("Attachment JSON: " + attachment.toString());

    CreateRequest attachmentRequest = new CreateRequest("Attachment", attachment);
    CreateResponse attachmentResponse = restApi.create(attachmentRequest);

    if (attachmentResponse.wasSuccessful()) {
        return attachmentResponse.getObject().get("_ref").getAsString();
    } else {
        System.out.println("Error occurred creating attachment:");
        for (String error : attachmentResponse.getErrors()) {
            System.out.println(error);
        }
        return null;
    }
}
