public void migrateTestStepsWithAttachments(String rallyTestCaseOID, List<JiraTestStep> jiraTestSteps, RallyRestApi rallyApi, List<String> fileAttachmentPaths, List<String> embeddedAttachmentPaths) {
    List<String> uploadedAttachments = new ArrayList<>();

    for (JiraTestStep jiraTestStep : jiraTestSteps) {
        try {
            JsonObject newTestStep = new JsonObject();
            newTestStep.addProperty("TestCase", rallyTestCaseOID);
            newTestStep.addProperty("StepIndex", jiraTestStep.getIndex());

            String inputField = (jiraTestStep.getStep() != null ? jiraTestStep.getStep() : "") +
                                (jiraTestStep.getTestData() != null ? "\n" + jiraTestStep.getTestData() : "");
            newTestStep.addProperty("Input", inputField);

            newTestStep.addProperty("ExpectedResult", jiraTestStep.getExpectedResult());

            if (embeddedAttachmentPaths != null && !embeddedAttachmentPaths.isEmpty()) {
                for (String embeddedPath : embeddedAttachmentPaths) {
                    if (!uploadedAttachments.contains(embeddedPath)) {
                        String attachmentURL = attachFileToRallyTestCase(rallyApi, rallyTestCaseOID, embeddedPath);
                        if (attachmentURL == null) {
                            logger.error("Failed to attach file: " + embeddedPath);
                            continue;
                        }

                        String attachmentOID = extractOID(attachmentURL);
                        if (attachmentOID == null) {
                            logger.error("Failed to extract OID from attachment URL: " + attachmentURL);
                            continue;
                        }

                        uploadedAttachments.add(embeddedPath);
                        newTestStep.addProperty("Input", newTestStep.get("Input").getAsString() + " <img src='https://rally1.rallydev.com/slm/attachment/" + attachmentOID + "/content'/>");
                    }
                }
            }

            CreateRequest createRequest = new CreateRequest("TestcaseStep", newTestStep);
            CreateResponse createResponse = rallyApi.create(createRequest);

            if (createResponse.wasSuccessful()) {
                String testStepURL = createResponse.getObject().get("_ref").getAsString();
                String testStepOID = extractOID(testStepURL);
                if (testStepOID != null) {
                    logger.info("Successfully created test step with OID: " + testStepOID);
                } else {
                    logger.error("Failed to extract OID from created test step URL: " + testStepURL);
                }
            } else {
                logger.error("Failed to create test step in Rally: " + Arrays.toString(createResponse.getErrors()));
            }
        } catch (IOException e) {
            logger.error("Exception occurred while creating test step in Rally", e);
        }
    }
}
