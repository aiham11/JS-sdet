public void migrateTestSteps(String rallyTestCaseRef, List<JiraTestStep> jiraTestSteps, RallyRestApi rallyRestApi, Map<Integer, List<String>> stepAttachmentOIDsMap) {
    Collections.reverse(jiraTestSteps);

    for (JiraTestStep step : jiraTestSteps) {
        try {
            JsonObject newTestStep = new JsonObject();
            newTestStep.addProperty("TestCase", rallyTestCaseRef);
            newTestStep.addProperty("StepIndex", step.getIndex());
            newTestStep.addProperty("Input", sanitize(step.getDescription()));
            newTestStep.addProperty("ExpectedResult", sanitize(step.getExpectedResult()));
            newTestStep.addProperty("TestData", sanitize(step.getTestData()));

            List<String> attachmentOIDs = stepAttachmentOIDsMap.get(step.getIndex());
            if (attachmentOIDs != null) {
                StringBuilder attachmentReferences = new StringBuilder();
                for (String attachmentOID : attachmentOIDs) {
                    String attachmentReference = "<img src=\"" + rallyBaseURL + "/attachment/" + attachmentOID + "\" />";
                    attachmentReferences.append(attachmentReference).append("<br/>");
                }

                // Append attachments to the correct fields
                if (!newTestStep.get("Input").getAsString().isEmpty()) {
                    newTestStep.addProperty("Input", newTestStep.get("Input").getAsString() + "<br/>" + attachmentReferences.toString());
                } else if (!newTestStep.get("ExpectedResult").getAsString().isEmpty()) {
                    newTestStep.addProperty("ExpectedResult", newTestStep.get("ExpectedResult").getAsString() + "<br/>" + attachmentReferences.toString());
                } else if (!newTestStep.get("TestData").getAsString().isEmpty()) {
                    newTestStep.addProperty("TestData", newTestStep.get("TestData").getAsString() + "<br/>" + attachmentReferences.toString());
                }
            }

            logger.debug("Test Step Payload: " + newTestStep.toString());  // Added for better logging and debugging

            CreateRequest createRequest = new CreateRequest("testcasestep", newTestStep);
            CreateResponse createResponse = rallyRestApi.create(createRequest);

            if (createResponse.wasSuccessful()) {
                logger.info("Successfully created test step: " + step.getDescription());
            } else {
                logger.error("Failed to create test step: " + step.getDescription() + ". Error: " + createResponse.getErrors());
            }
        } catch (Exception e) {
            logger.error("Exception while creating test step: " + step.getDescription(), e);
        }
    }
}
