public void migrateTestSteps(String rallyTestCaseRef, List<JiraTestStep> jiraTestSteps, RallyRestApi rallyRestApi, List<String> attachmentOIDs) {
    Collections.reverse(jiraTestSteps);

    for (int i = 0; i < jiraTestSteps.size(); i++) {
        JiraTestStep step = jiraTestSteps.get(i);
        try {
            JsonObject newTestStep = new JsonObject();
            newTestStep.addProperty("TestCase", rallyTestCaseRef);
            newTestStep.addProperty("StepIndex", step.getIndex());
            newTestStep.addProperty("Input", step.getDescription());
            newTestStep.addProperty("ExpectedResult", step.getExpectedResult());
            newTestStep.addProperty("TestData", step.getTestData());

            CreateRequest createRequest = new CreateRequest("testcasestep", newTestStep);
            CreateResponse createResponse = rallyRestApi.create(createRequest);

            if (createResponse.wasSuccessful()) {
                String rallyTestStepOID = createResponse.getObject().get("_ref").getAsString();
                logger.info("Successfully created test step: " + step.getDescription());

                // Move corresponding attachments to the test step
                moveAttachmentsToTestStep(rallyTestStepOID, attachmentOIDs, rallyRestApi);
            } else {
                logger.error("Failed to create test step: " + step.getDescription() + ". Error: " + createResponse.getErrors());
            }
        } catch (Exception e) {
            logger.error("Exception while creating test step: " + step.getDescription(), e);
        }
    }
}

private void moveAttachmentsToTestStep(String rallyTestStepOID, List<String> attachmentOIDs, RallyRestApi rallyRestApi) {
    for (String attachmentOID : attachmentOIDs) {
        try {
            JsonObject updateAttachment = new JsonObject();
            updateAttachment.addProperty("Artifact", rallyTestStepOID);

            UpdateRequest updateRequest = new UpdateRequest(attachmentOID, updateAttachment);
            UpdateResponse updateResponse = rallyRestApi.update(updateRequest);

            if (updateResponse.wasSuccessful()) {
                logger.info("Successfully moved attachment OID " + attachmentOID + " to test step " + rallyTestStepOID);
            } else {
                logger.error("Failed to move attachment OID " + attachmentOID + " to test step " + rallyTestStepOID + ". Error: " + updateResponse.getErrors());
            }
        } catch (Exception e) {
            logger.error("Exception while moving attachment OID " + attachmentOID + " to test step " + rallyTestStepOID, e);
        }
    }
}









rallyOperation.migrateTestSteps(rallyTestcaseOID, testSteps, rallyRestApi, testcaseAttachmentOIDs);
